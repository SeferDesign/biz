<% provide(:title, "Goal ##{@goal.id} | ") %>
<section id="goal-show">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				<h1>Goal #<%= @goal.id %></h1>
				<p class="doicons">
					<%= link_to edit_goal_path(@goal), title: 'Edit' do %><i class="fa fa-fw fa-2x fa-pencil-square-o text-warning"></i><% end %>
					<%= link_to goal_path(@goal), title: 'Delete', method: :delete, data: { confirm: "Are you sure you would like to delete Goal ##{@goal.id}?" } do %><i class="fa fa-fw fa-2x fa-trash-o text-danger"></i><% end %>
				</p>
				<div class="row">
					<div class="col-sm-4">
						<p><strong>Time Period:</strong> <%= @goal.timeperiod %></p>
						<p><strong>Start Date:</strong> <%= @goal.startdate %></p>
						<p><strong>End Date:</strong> <%= @goal.enddate %></p>
						<p><strong>Status:</strong> <%= @goal.status %></p>
					</div>
					<div class="col-sm-4">
						<p><strong>Type:</strong> <%= @goal.goaltype %></p>
						<p><strong>Amount:</strong> <%= number_to_currency(@goal.amount, { :negative_format => '(%n)' }) %></p>
						<% if @goal.status == 'Current' or @goal.status == 'Past' %><p><strong>Actual:</strong> <%= number_to_currency(@goal.actualamount, { :negative_format => '(%n)' }) %></p><% end %>
					</div>
					<div class="col-sm-4">
						<%
							@progressRaw = @goal.actualamount / @goal.amount
							@progress = number_to_percentage(@progressRaw * 100, :strip_insignificant_zeros => true, :precision => 2)
						%>
						<% if @goal.status == 'Past' %>
						<p>
							<strong>Met?</strong>
							<% if @goal.met %>
							<i class="fa fa-check green"></i>
							<% else %>
							<span class="red"><strong>&times;</strong></span>
							<% end %>
						</p>
						<% elsif @goal.status == 'Current' %>
						<%
							@fullPeriodDays = (@goal.enddate - @goal.startdate + 1).to_f
							@paceDays = (Date.today - @goal.startdate + 1).to_f
							@paceRaw = @paceDays / @fullPeriodDays
							@pace = number_to_percentage(@paceRaw * 100, :strip_insignificant_zeros => true, :precision => 2)
						%>
						<p><strong>Goal Pace:</strong> <%=  @pace %></p>
						<p><strong>Actual Progress:</strong> <%= @progress %></p>
						<% elsif @goal.status == 'Future' %>
						<p>
							<strong>Actual Progress:</strong> &mdash;
						</p>
						<% end %>
						<% if @goal.status == 'Current' %>
							<%
								if @progressRaw > @paceRaw
									@firstLengthRaw = @paceRaw
									@firstLength = @pace
									@secondLength = number_to_percentage((@progressRaw - @paceRaw) * 100, :strip_insignificant_zeros => true, :precision => 2)
								else
									@firstLengthRaw = @progressRaw
									@firstLength = @progress
									@secondLength = number_to_percentage((@paceRaw - @firstLengthRaw) * 100, :strip_insignificant_zeros => true, :precision => 2)
								end
							%>
							<div class="progress progress-striped">
								<div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="<%= @firstLength %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= @firstLength %>"></div>
								<div class="progress-bar progress-bar-<% if @progressRaw > @paceRaw %>success<% else %>danger<% end %>" role="progressbar" aria-valuenow="<%= @secondLength %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= @secondLength %>"></div>
							</div>
						<% end %>
					</div>
				</div>
			</div>
			<div class="col-sm-12">
				<h3>Paid Invoices</h3>
				<% if @invoicesPaid.blank? %>
				<p class="lead">No paid invoices.</p>
				<% else %>
				<table class="table table-condensed">
					<thead>
						<tr>
							<th>Client</th>
							<th>Issue Date</th>
							<th>Paid Date</th>
							<th class="text-center hidden-xs">Type</th>
							<th class="text-right">Cost</th>
							<th class="text-center">Paid?</th>
						</tr>
					</thead>
					<tbody>
						<% @invoicesPaid.each do |invoice| %>
						<tr id="invoicerow<%= invoice.id %>">
							<td><%= link_to Client.find(invoice.client_id) do %><%= Client.find(invoice.client_id).name %><% end %></td>
							<td><%= link_to invoice do %><%= invoice.date %><% end %></td>
							<td><%= invoice.paiddate %></td>
							<td class="text-center hidden-xs"><%= invoice.worktype %></td>
							<td class="text-right"><% if invoice.cost %><%= number_to_currency(invoice.cost, { :negative_format => '(%n)' }) %><% else %>&mdash;<% end %></td>
							<td class="text-center"><% if invoice.paid == true %><i class="fa fa-check green"></i><% else %><span class="spread red">Not Paid</span><% end %></td>
						</tr>
						<% end %>
					</tbody>
				</table>
				<% end %>
			</div>
		</div>
		<div class="row hidden-print">
			<div class="col-sm-12">
				<p><%= link_to 'Back', goals_path %></p>
			</div>
		</div>
	</div>
</section>
