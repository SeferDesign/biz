<% if user_signed_in? %>
<% provide(:title, "Invoice ##{@invoice.id} | ") %>
<% else %>
<% provide(:title, "Invoice #{@invoice.display_id} | ") %>
<% end %>
<section id="invoice-show">
	<div class="container">
		<div class="row">
			<div class="col-sm-<% if user_signed_in? %>12<% else %>8 col-sm-offset-2<% end %>">
				<% if @invoice.client.logo.present? %>
				<%= image_tag(@invoice.client.logo.url(), class: 'client-logo pull-right hidden-xs') %>
				<% end %>
				<% if user_signed_in? %>
				<h1>Invoice #<%= @invoice.id %></h1>
				<p class="doicons">
					<%= link_to invoice_path(:format => 'pdf'), title: 'PDF' do %><%= icon('fas', 'file', class: 'fa-fw fa-2x text-success') %><% end %>
					<%= link_to edit_invoice_path(@invoice), title: 'Edit' do %><%= icon_action_edit %><% end %>
					<%= link_to invoice_path(@invoice), title: 'Delete', method: :delete, data: { confirm: "Are you sure you would like to delete Invoice ##{@invoice.id}?" } do %><%= icon_action_delete %><% end %>
					<%= link_to email_invoice_path(@invoice), title: 'Send' do %><%= icon('far', 'envelope-open', class: 'fa-fw fa-2x text-success') %><% end %>
					<% if !@invoice.paid? %><%= link_to mark_paid_invoice_path(@invoice), id: 'paid-today-btn', title: 'Paid Today?', class: 'btn btn-sm btn-warning', remote: true do %>Paid Today?<% end %><% end %>
				</p>
				<% end %>
				<% if @invoice.paid == true and !user_signed_in? %>
				<p><%= link_to invoice_path(:format => 'pdf', :access_token => @invoice.access_token), { :target => '_blank' } do %>Download Invoice marked 'PAID'<% end %></p>
				<% end %>
				<p>
					<strong>Client:</strong>
					<% if user_signed_in? %><%= link_to @invoice.client do %><%= @invoice.client.name %><% end %><% else %><%= @invoice.client.name %><% end %>
				</p>
				<% if user_signed_in? %>
				<% if @invoice.access_token.present? %>
				<p>
					<strong>Access Token:</strong> <%= @invoice.access_token %> (<a href="<%= invoice_path(@invoice) %>?access_token=<%= @invoice.access_token %>">Client Link</a>)
				</p>
				<% end %>
				<% end %>
				<p>
					<strong>Invoice ID<% if user_signed_in? %> Display<% end %>:</strong>
					<%= @invoice.display_id %>
				</p>
				<p>
					<strong>Date:</strong>
					<%= @invoice.date.to_formatted_s(:long) %>
				</p>
				<p>
					<strong>Work Type:</strong>
					<%= @invoice.worktype %>
				</p>
				<p>
					<strong>Cost:</strong>
					<span class="currency"><%= number_to_currency(@invoice.cost, { :negative_format => '(%n)' }) %></span>
				</p>
				<% if @invoice.paid == false %>
				<p>
					<strong>Paid?:</strong>
					<% if @invoice.paid == true %><%= icon('fas', 'check', class: 'green') %><% else %><span class="spread red">Not Paid</span><% end %>
				</p>
				<% else %>
				<p>
					<span class="spread green">Paid</span> on
					<%= @invoice.paiddate.to_formatted_s(:long) %>
				</p>
				<% if !@invoice.paymenttype.blank? %>
				<p>
					<strong>Payment Method:</strong>
					<%= @invoice.paymenttype %>
				</p>
				<% end %>
				<% end %>
				<p><strong>Description:</strong></p>
				<p><%= @invoice.description %></p>
				<% if !@invoice.lines.blank? %>
				<table class="table table-hover table-condensed">
					<thead>
						<tr>
		          <% if user_signed_in? %>
							<th>&nbsp;</th>
		          <% end %>
							<th>Description</th>
							<th class="text-center">Hours</th>
							<th class="text-center">Rate ($) per Hour</th>
							<th class="text-center">Cost</th>
						</tr>
					</thead>
					<tbody>
						<%= render @invoice.lines %>
					</tbody>
					<tfoot>
						<tr>
		          <% if user_signed_in? %>
							<td>&nbsp;</td>
		          <% end %>
							<td class="text-right" colspan="3"><strong>Total</strong>&nbsp;&nbsp;</td>
							<td class="currency"><strong><div class="pull-right"><%= number_to_currency(@invoice.lines.sum('total'), { :unit => '', :negative_format => '(%n)' }) %></div>$</strong></td>
						</tr>
					</tfoot>
				</table>
				<% end %>
		    <% if !user_signed_in? and !@invoice.paid and @invoice.access_token.present? %>
				<%= render 'payment-options' %>
		    <% end %>
				<% if user_signed_in? %>
				<h2>Add a line:</h2>
				<%= render 'lines/form' %>
				<div class="row hidden-print">
					<div class="col-sm-12">
						<p><%= link_to 'Back', invoices_path %></p>
					</div>
				</div>
				<% end %>
			</div>
		</div>
	</div>
</section>
